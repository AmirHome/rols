---
title: "`r Biocpkg('rols')`: an R interface to the Ontology Lookup Service"
output:
  BiocStyle::html_document:
     toc: true
     toc_depth: 1
vignette: >
  %\VignetteIndexEntry{The rols interface to the Ontology Lookup Service}
  % \VignetteEngine{knitr::rmarkdown}
  %\VignetteKeywords{Infrastructure, Bioinformatics, ontology, data}
  %\VignettePackage{rols}
---

```{r style, echo = FALSE, results = 'asis', message=FALSE}
BiocStyle::markdown()
```

**Package**: `r Biocpkg("rols")`<br />
**Authors**: `r packageDescription("rols")[["Author"]]`<br />
**Modified:** `r file.info("rols.Rmd")$mtime`<br />
**Compiled**: `r date()`


```{r env, echo=FALSE}
suppressPackageStartupMessages(library("GO.db"))
suppressPackageStartupMessages(library("rols"))
suppressPackageStartupMessages(library("DT"))
nonto <- length(ol <- Ontologies())
```

# Introduction

The [Ontology Lookup Service](http://www.ebi.ac.uk/ontology-lookup/)
(OLS)
[[1](http://bmcbioinformatics.biomedcentral.com/articles/10.1186/1471-2105-7-97),
[2](http://nar.oxfordjournals.org/content/36/suppl_2/W372)] is
originally spin-off of the
[PRoteomics IDEntifications](http://www.ebi.ac.uk/pride/archive/)
database (PRIDE) service, located at the EBI, and is now developed and
maintained by the
[Samples, Phenotypes and Ontologies](http://www.ebi.ac.uk/about/spot-team)
team at EMBL-EBI.


The OLS provides a REST interface to hundreds of ontologies from a
single location with a unified output format. The `r Biocpkg("rols")`
package make this possible from within R. Do do so, it relies on the
`r CRANpkg("httr")` package to query the REST interface, and access
and retrieve data.

# Brief \Biocpkg{rols} overview

## Ontologies

There are `r nonto` ontologies available in the OLS, listed in the
table below. Their name is to be use to defined which ontology to
query.


```{r ontTable, echo = FALSE}
datatable(as(ol, "data.frame"))
```

## Interface

```{r}
library("rols")
```

# Use case

```{r, echo=FALSE}
alltgns <- OlsSearch(q = "trans-golgi network")
```

A researcher might be interested in the trans-Golgi network. Searching
the OLS is assured by the `OlsSearch` and `olsSearch` functions. The
first step is to defined the search query with `OlsSearch`, as shown
below. This creates an search object of class `OlsSearch` that stores
the query and its parameters. In records the number of requested
results (default is 20) and the total number of possible results
(there are `r alltgns@numFound` results across all ontologies, in this
case). At this stage, the results have not yet been downloaded, as
shown by the `r nrow(alltgns@response)` responses. 

```{r tgnquery, eval = TRUE}
OlsSearch(q = "trans-golgi network")
```

`r alltgns@numFound` results are probably too many to be
relevant. Below we show how to perform an exact search by setting
\code{exact = TRUE}, limiting the search the the GO ontology by
specifying `ontology = "GO"` or doing both

```{r tgnquery1, eval = TRUE}
OlsSearch(q = "trans-golgi network", exact = TRUE)
OlsSearch(q = "trans-golgi network", ontology = "GO")
OlsSearch(q = "trans-golgi network", ontology = "GO", exact = TRUE)
```

One case set the `rows` argument to set the number of desired results.

```{r tgnquery2}
OlsSearch(q = "trans-golgi network", ontology = "GO", rows = 200)
```

Alternatively, one can call the `allRows` function to request all results.

```{r tgnquery3}
(tgnq <- OlsSearch(q = "trans-golgi network", ontology = "GO"))
(tgnq <- allRows(tgnq))
```

```{r tgnsear4, echo=FALSE}
qry <- OlsSearch(q = "trans-golgi network", exact = TRUE)
```

Let's proceed with the exact serach and retrieve the results. Even if
we request the default 20 results, only the `r qry@numFound` relevant
result will be retrieved. The `olsSearch` function updates the
previously created object (called `qry` below) by adding the results
to it.

```{r tgnquery5}
qry <- OlsSearch(q = "trans-golgi network", exact = TRUE)
(qry <- olsSearch(qry))
```

We can now transform this search result object into a fully fledged
`Terms` object or a `data.frame`.

```{r tgnres}
(qtrms <- as(qry, "Terms"))
(qdrf <- as(qry, "data.frame"))
```

In the case, we can that we actually retrieve the same term used
across different ontologies. In such cases, it might be useful to use
only keep non-redundant term instances, which would have been
equivalent to search the `r termOntology(unique(qtrms))` ontology

```{r uterms}
qtrms <- unique(qtrms)
termOntology(qtrms)
termNamespace(qtrms)
```

Below, we execute the same query using the \Biocpkg{GO.db} package.

```{r go.db, message=FALSE}
library("GO.db")
GOTERM[["GO:0005802"]]
```

# On-line vs. off-line data

It is possible to observe different results with `r Biocpkg("rols")`
and ` r Biocpkg("GO.db")`, as a result of the different ways they
access the data. `r Biocpkg("rols")` or ` r Biocpkg("biomaRt")`
perform direct online queries, while `r Biocpkg("GO.db")` and other
annotation packages use database snapshot that are updated every
release.

Both approaches have advantages. While online queries allow to obtain
the latest up-to-date information, such approaches rely on network
availability and quality. If reproducibility is a major issue, the
version of the database to be queried can easily be controlled with
off-line approaches. In the case of `r Biocpkg("rols")`, altough the
load date of a specific ontology can be queried with `olsVersion`, it
is not possible to query a specific version of an ontology.

# Changes in `r Biocpkg("rols")` 2.0

```
## Development script for rols version 2.

## Release plan
##  Update release package on the 1st of March, so that the release
##  version continues to work using the archive URL until the next
##  release in April. Commit a devel version, that uses the REST api,
##  before release.


## http://www.ebi.ac.uk/ols/beta/docs/api
## http://www.ebi.ac.uk/ols/beta/roadmap.html

## "ontologies"
## ontologyLoadDate -> olsLoaded
##                  -> olsUpdated
## ontologyNames -> see ontologies
## olsVersion -> olsVersion
## allIds -> terms
## "isIdObsolete" -> isObsolete
## "rootId"       -> olsRoot
## olsQuery       -> OlsSearch, olsSearch

## CVParams unchanged

## Dropping
## .rols environment
## "as.character.Map"  "key"  "CVParam"
## "as.character.mapItem"
```


# Session information

```{r si, echo=FALSE}
print(sessionInfo(), locale = FALSE)
```
